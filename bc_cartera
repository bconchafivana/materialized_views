CREATE VIEW bc_cartera AS (
SELECT
    o.no_reception,
    d.document_id,
    o.operation_id,
    d.client_rut,
    d.client_name,
    d.debtor_rut,
    d.debtor_name,
    d.debtor_category,
    d.backoffice_status,
    CONCAT(d.client_rut, '_', d.debtor_rut) AS client_debtor,
    o.base_rate,
    o.finance_amount AS o_finance_amount,
    o.transfer_amount AS o_transfer_amount,
    o.total_amount,
    o.comissions,
    o.financial_cost,
    o.no_finance_amount,
    o.expenses,
    o.finance_percent,
    o.taxes,
    d.finance_amount AS d_finance_amount,
    d.paid_amount AS d_paid_amount,
    d.financed_balance AS d_financed_balance,
    d.amount AS d_amount,
    o.executive_id,
    o.executive_name,
    o.status_description,
    d.status,
    o.expiry_days,
    od.issue_date,
    o.operation_date,
    o.carry_out_date,
    od.expiry_date,
    d.custom_expiration_utc,
    DATEDIFF(od.expiry_date, o.operation_date) AS n_total_days,
    d.cesion_owner,
    o.delay_rate,
    d.document_type,
    d.no_reception_doc,
    d.folio,
    FROM_UNIXTIME(d.emission) AS emission_date,
    d.status_resale,
    d.finance_amount,
    d.financed_balance,
    d.reseller_status,
    d.has_annulment_nc,
    d.sii_reclaimed,
    d.cesion_owner_name,
    d.confirmation_verification_date,
    d.confirmation_verification_state,
    d.reseller_investor_name,
    d.collect_executive_id,
    d.collect_executive_name,
    d.last_management,
    d.next_management_date,
    d.last_payment_date,
    d.sii_executive_merit,
    FROM_UNIXTIME(d.expiration) AS expiration_date,
    d.original_amount,
    d.comercial_executive_id,
    d.normalization_executive_id,
    d.normalization_executive_name,
    d.abonado_date_utc,
    d.last_management_date,
    d.document_type_description,
    d.published_client_dicom,
    d.published_debtor_dicom,
    d.has_amount_nc,
    d.has_text_nc,
    d.judicial_cause_id,
    d.judicial_cause_status,
    d.date_annulment_nc
 from fc_documents d
 inner join fc_rf_operation_documents od on d.document_id = od.document_id
 inner join fc_operations o on o.operation_id = od.operation_id
 WHERE d.status = 2
 AND d.backoffice_status != 'Cas'
 AND (d.deleted is null OR d.deleted = 0)
) 
